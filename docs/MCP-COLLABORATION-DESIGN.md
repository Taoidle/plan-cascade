# Plan Cascade ä¸ MCP æœåŠ¡ååŒå·¥ä½œè®¾è®¡

> ç‰ˆæœ¬: 1.0.0
> æ—¥æœŸ: 2026-01-28

---

## æ ¸å¿ƒæµç¨‹ä¸ MCP ååŒç‚¹

Plan Cascade çš„ä¸‰å±‚æ¶æ„åœ¨ä¸åŒé˜¶æ®µå¯ä»¥ä¸ MCP æœåŠ¡ååŒï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Plan Cascade æ‰§è¡Œæµç¨‹                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  PRD ç”Ÿæˆ    â”‚â”€â”€â”€â–¶â”‚  æ‰¹æ¬¡æ‰§è¡Œ    â”‚â”€â”€â”€â–¶â”‚  å®Œæˆé€šçŸ¥    â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚         â”‚                   â”‚                   â”‚                          â”‚
â”‚         â–¼                   â–¼                   â–¼                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  Context7    â”‚    â”‚Claude Contextâ”‚    â”‚    Slack     â”‚                  â”‚
â”‚  â”‚  (åº“æ–‡æ¡£)    â”‚    â”‚ (ä»£ç æœç´¢)   â”‚    â”‚   (é€šçŸ¥)     â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## é˜¶æ®µ 1: PRD ç”Ÿæˆ

### å½“å‰æµç¨‹

```
ç”¨æˆ·æè¿° â†’ prd_generator.py â†’ prd.json
```

**æ–‡ä»¶**: `skills/hybrid-ralph/core/prd_generator.py`

```python
def generate_prd(self, description: str, context: Optional[Dict] = None) -> Dict:
    prd = {
        "goal": self._extract_goal(description),
        "objectives": self._extract_objectives(description),
        "stories": []
    }
    return prd
```

### ä¸ Context7 ååŒ

**åœºæ™¯**: ç”¨æˆ·æè¿°ä¸­æåˆ°ç‰¹å®šåº“æ—¶ï¼Œè‡ªåŠ¨è·å–è¯¥åº“æ–‡æ¡£

```
ç”¨æˆ·: "ä½¿ç”¨ NextAuth å®ç° OAuth2 ç™»å½•"
                    â”‚
                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ è°ƒç”¨ Context7 MCP   â”‚
         â”‚ resolve-library-id  â”‚
         â”‚ query-docs          â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ å¢å¼º PRD ç”Ÿæˆ       â”‚
         â”‚ - æ­£ç¡®çš„ API ç”¨æ³•   â”‚
         â”‚ - ç‰ˆæœ¬ç‰¹å®šé…ç½®      â”‚
         â”‚ - æœ€ä½³å®è·µ          â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å¢å¼ºåçš„ PRD ç”Ÿæˆ**:

```python
# prd_generator.py å¢å¼ºç‰ˆ (æ¦‚å¿µè®¾è®¡)

class EnhancedPRDGenerator(PRDGenerator):
    """å¢å¼ºçš„ PRD ç”Ÿæˆå™¨ï¼Œé›†æˆ MCP æœåŠ¡"""

    def generate_prd(self, description: str, context: Optional[Dict] = None) -> Dict:
        # 1. æ£€æµ‹æè¿°ä¸­æåˆ°çš„åº“/æ¡†æ¶
        libraries = self._detect_libraries(description)
        # ä¾‹å¦‚: ["nextauth", "prisma", "tailwindcss"]

        # 2. è·å–åº“æ–‡æ¡£ (é€šè¿‡ Context7)
        library_docs = {}
        for lib in libraries:
            # è¿™äº›è°ƒç”¨ä¼šç”± Claude åœ¨ç”Ÿæˆ PRD æ—¶è‡ªåŠ¨æ‰§è¡Œ
            # å› ä¸º Context7 MCP å·²ç»å¯ç”¨
            library_docs[lib] = f"ä½¿ç”¨ Context7 è·å– {lib} æœ€æ–°æ–‡æ¡£"

        # 3. ç”Ÿæˆæ›´å‡†ç¡®çš„ PRD
        prd = super().generate_prd(description, context)

        # 4. å°†åº“æ–‡æ¡£å¼•ç”¨æ·»åŠ åˆ° PRD
        prd["library_references"] = libraries

        return prd

    def _detect_libraries(self, description: str) -> List[str]:
        """ä»æè¿°ä¸­æ£€æµ‹åº“å"""
        # å¸¸è§åº“åæ¨¡å¼åŒ¹é…
        patterns = [
            r'\b(next\.?js|nextjs)\b',
            r'\b(react)\b',
            r'\b(prisma)\b',
            r'\b(nextauth|next-auth)\b',
            r'\b(tailwind|tailwindcss)\b',
            # ... æ›´å¤šæ¨¡å¼
        ]
        # è¿”å›åŒ¹é…åˆ°çš„åº“å
        ...
```

**å®é™…å·¥ä½œæ–¹å¼** (åˆ©ç”¨ Claude çš„ MCP èƒ½åŠ›):

ç”±äº Claude Code å·²ç»å¯ç”¨äº† Context7 MCPï¼Œåœ¨ç”Ÿæˆ PRD æ—¶ï¼ŒClaude ä¼šï¼š

1. è¯†åˆ«ç”¨æˆ·æè¿°ä¸­çš„åº“/æ¡†æ¶åç§°
2. è‡ªåŠ¨è°ƒç”¨ `resolve-library-id` å’Œ `query-docs`
3. åŸºäºæœ€æ–°æ–‡æ¡£ç”Ÿæˆæ›´å‡†ç¡®çš„ stories å’Œ acceptance criteria

**æ— éœ€ä¿®æ”¹ä»£ç **ï¼Œåªéœ€åœ¨ PRD ç”Ÿæˆçš„ prompt ä¸­æ·»åŠ æŒ‡ä»¤ï¼š

```markdown
# commands/hybrid-worktree.md å¢å¼º

ç”Ÿæˆ PRD æ—¶ï¼š
1. è¯†åˆ«ç”¨æˆ·æè¿°ä¸­æåˆ°çš„åº“å’Œæ¡†æ¶
2. ä½¿ç”¨ Context7 (use context7) è·å–è¿™äº›åº“çš„æœ€æ–°æ–‡æ¡£
3. åŸºäºæœ€æ–° API å’Œæœ€ä½³å®è·µç”Ÿæˆ stories
4. åœ¨ acceptance criteria ä¸­ä½¿ç”¨æ­£ç¡®çš„ API è°ƒç”¨æ–¹å¼
```

---

## é˜¶æ®µ 2: Story æ‰§è¡Œ

### å½“å‰æµç¨‹

```
orchestrator.py
    â”‚
    â”œâ”€â”€ context_filter.py  â† è·å– story ä¸Šä¸‹æ–‡
    â”‚       â”‚
    â”‚       â”œâ”€â”€ ä» prd.json è¯»å– story è¯¦æƒ…
    â”‚       â”œâ”€â”€ ä» findings.md è¯»å–ç›¸å…³å‘ç°
    â”‚       â””â”€â”€ ä» progress.txt è¯»å–ä¾èµ–çŠ¶æ€
    â”‚
    â””â”€â”€ ç”Ÿæˆ Agent Prompt â†’ Task Agent æ‰§è¡Œ
```

**æ–‡ä»¶**: `src/plan_cascade/state/context_filter.py` (åŸä¸º skills/hybrid-ralph/core/context_filter.py)

```python
def get_context_for_story(self, story_id: str) -> Dict:
    return {
        "story": story,
        "dependencies": dependency_summaries,
        "findings": findings_context,  # ä»…æ¥è‡ªæœ¬åœ° findings.md
        "context_estimate": story.get("context_estimate", "medium")
    }
```

### ä¸ Claude Context (ä»£ç æœç´¢) ååŒ

**åœºæ™¯**: Story æ‰§è¡Œå‰ï¼Œæœç´¢ç›¸å…³ä»£ç 

```
Story: "å®ç°ç”¨æˆ·è®¤è¯ä¸­é—´ä»¶"
                    â”‚
                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ è°ƒç”¨ Claude Context â”‚
         â”‚ search_code         â”‚
         â”‚ "authentication     â”‚
         â”‚  middleware user"   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ è¿”å›ç›¸å…³ä»£ç ç‰‡æ®µ    â”‚
         â”‚ - ç°æœ‰ auth å®ç°    â”‚
         â”‚ - ä¸­é—´ä»¶æ¨¡å¼        â”‚
         â”‚ - ç›¸å…³é…ç½®          â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ å¢å¼º Agent ä¸Šä¸‹æ–‡   â”‚
         â”‚ Agent äº†è§£ç°æœ‰ä»£ç   â”‚
         â”‚ é¿å…é‡å¤å®ç°        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å¢å¼ºåçš„ä¸Šä¸‹æ–‡è¿‡æ»¤**:

```python
# context_filter.py å¢å¼ºç‰ˆ (æ¦‚å¿µè®¾è®¡)

class EnhancedContextFilter(ContextFilter):
    """å¢å¼ºçš„ä¸Šä¸‹æ–‡è¿‡æ»¤å™¨ï¼Œé›†æˆä»£ç æœç´¢"""

    def get_context_for_story(self, story_id: str) -> Dict:
        # 1. è·å–åŸºç¡€ä¸Šä¸‹æ–‡ (ç°æœ‰é€»è¾‘)
        base_context = super().get_context_for_story(story_id)

        story = base_context.get("story", {})
        if not story:
            return base_context

        # 2. ç”Ÿæˆä»£ç æœç´¢æŸ¥è¯¢
        search_queries = self._generate_search_queries(story)
        # ä¾‹å¦‚: ["user authentication", "middleware pattern", "jwt token"]

        # 3. è°ƒç”¨ Claude Context æœç´¢ä»£ç  (æ¦‚å¿µ)
        # å®é™…ç”± Claude åœ¨æ‰§è¡Œæ—¶è‡ªåŠ¨è°ƒç”¨
        code_context = {
            "search_queries": search_queries,
            "instruction": "ä½¿ç”¨ claude-context æœç´¢è¿™äº›æŸ¥è¯¢ï¼Œè·å–ç›¸å…³ä»£ç "
        }

        # 4. åˆå¹¶ä¸Šä¸‹æ–‡
        base_context["code_search"] = code_context

        return base_context

    def _generate_search_queries(self, story: Dict) -> List[str]:
        """ä» story ç”Ÿæˆä»£ç æœç´¢æŸ¥è¯¢"""
        queries = []

        # ä»æ ‡é¢˜æå–å…³é”®è¯
        title = story.get("title", "")
        queries.append(title)

        # ä» tags ç”ŸæˆæŸ¥è¯¢
        tags = story.get("tags", [])
        queries.extend(tags)

        # ä» acceptance criteria æå–å…³é”®æ¦‚å¿µ
        for ac in story.get("acceptance_criteria", []):
            # æå–å…³é”®æŠ€æœ¯æœ¯è¯­
            # ...
            pass

        return queries[:5]  # é™åˆ¶æŸ¥è¯¢æ•°é‡
```

**å®é™…å·¥ä½œæ–¹å¼** (Agent Prompt å¢å¼º):

ä¿®æ”¹ `orchestrator.py` ä¸­çš„ `StoryAgent.get_agent_prompt()`:

```python
def get_agent_prompt(self) -> str:
    prompt = f"""You are executing story {self.story_id}: {self.story['title']}

## ç¬¬ä¸€æ­¥ï¼šä»£ç åº“æœç´¢ (é‡è¦!)

åœ¨å¼€å§‹å®ç°ä¹‹å‰ï¼Œè¯·ä½¿ç”¨ claude-context MCP æœç´¢ç›¸å…³ä»£ç :

1. æœç´¢æŸ¥è¯¢: "{self.story['title']}"
2. æœç´¢æ ‡ç­¾: {', '.join(self.story.get('tags', []))}

è¿™å°†å¸®åŠ©ä½ äº†è§£:
- ç°æœ‰çš„ç›¸å…³å®ç°
- é¡¹ç›®çš„ä»£ç é£æ ¼å’Œæ¨¡å¼
- å¯å¤ç”¨çš„ç»„ä»¶å’Œå·¥å…·å‡½æ•°

## ç¬¬äºŒæ­¥ï¼šè·å–åº“æ–‡æ¡£ (å¦‚éœ€è¦)

å¦‚æœå®ç°æ¶‰åŠå¤–éƒ¨åº“ï¼Œä½¿ç”¨ Context7 è·å–æœ€æ–°æ–‡æ¡£:
- è¯´ "use context7" è·å–åº“çš„æœ€æ–° API æ–‡æ¡£

## Story è¯¦æƒ…

Description:
{self.story['description']}

Acceptance Criteria:
{chr(10).join(f'- {c}' for c in self.story.get('acceptance_criteria', []))}

## ä¾èµ–æ‘˜è¦
{self._format_dependencies()}

## ç›¸å…³å‘ç°
{self._format_findings()}

## å®Œæˆæ­¥éª¤
1. æœç´¢ç›¸å…³ä»£ç  (claude-context)
2. è·å–åº“æ–‡æ¡£ (context7)
3. å®ç° story
4. æµ‹è¯•å®ç°
5. æ›´æ–° findings.md (æ ‡è®° <!-- @tags: {self.story_id} -->)
6. æ ‡è®°å®Œæˆ: è¿½åŠ åˆ° progress.txt: [COMPLETE] {self.story_id}
"""
    return prompt
```

---

## é˜¶æ®µ 3: å®Œæˆé€šçŸ¥

### å½“å‰æµç¨‹

```
Story å®Œæˆ â†’ æ›´æ–° progress.txt â†’ æ‰‹åŠ¨æ£€æŸ¥çŠ¶æ€
```

**æ–‡ä»¶**: `skills/hybrid-ralph/core/orchestrator.py`

```python
def check_batch_complete(self, batch: List[Dict]) -> bool:
    for story in batch:
        status = self.get_story_status(story["id"])
        if status != "complete":
            return False
    return True
```

### ä¸ Slack ååŒ

**åœºæ™¯**: æ‰¹æ¬¡å®Œæˆæ—¶è‡ªåŠ¨é€šçŸ¥

```
Batch 1 å®Œæˆ
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è°ƒç”¨ Slack MCP      â”‚
â”‚ conversations_      â”‚
â”‚ add_message         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Slack Channel       â”‚
â”‚ "ğŸ‰ Batch 1 å®Œæˆ    â”‚
â”‚  3/3 stories done"  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å¢å¼ºåçš„ç¼–æ’å™¨**:

```python
# orchestrator.py å¢å¼ºç‰ˆ (æ¦‚å¿µè®¾è®¡)

class EnhancedOrchestrator(Orchestrator):
    """å¢å¼ºçš„ç¼–æ’å™¨ï¼Œé›†æˆ Slack é€šçŸ¥"""

    def __init__(self, project_root: Path):
        super().__init__(project_root)
        self.slack_channel = "#dev-progress"  # å¯é…ç½®

    def on_story_complete(self, story_id: str, story: Dict):
        """Story å®Œæˆæ—¶çš„å›è°ƒ"""
        # å‘é€ Slack é€šçŸ¥
        message = f"âœ… Story `{story_id}` å®Œæˆ: {story['title']}"
        self._send_slack_notification(message)

    def on_story_failed(self, story_id: str, error: str):
        """Story å¤±è´¥æ—¶çš„å›è°ƒ"""
        message = f"âŒ Story `{story_id}` å¤±è´¥:\n```{error}```"
        self._send_slack_notification(message)

    def on_batch_start(self, batch_num: int, stories: List[Dict]):
        """æ‰¹æ¬¡å¼€å§‹æ—¶çš„å›è°ƒ"""
        story_list = "\n".join([f"  â€¢ {s['id']}: {s['title']}" for s in stories])
        message = f"ğŸš€ **Batch {batch_num}** å¼€å§‹æ‰§è¡Œ ({len(stories)} stories)\n{story_list}"
        self._send_slack_notification(message)

    def on_batch_complete(self, batch_num: int, stories: List[Dict]):
        """æ‰¹æ¬¡å®Œæˆæ—¶çš„å›è°ƒ"""
        message = f"ğŸ‰ **Batch {batch_num}** å…¨éƒ¨å®Œæˆ ({len(stories)}/{len(stories)} stories)"
        self._send_slack_notification(message)

    def on_feature_complete(self, feature_name: str):
        """Feature å®Œæˆæ—¶çš„å›è°ƒ"""
        message = f"ğŸ† **Feature: {feature_name}** å¼€å‘å®Œæˆï¼"
        self._send_slack_notification(message)

    def _send_slack_notification(self, message: str):
        """å‘é€ Slack é€šçŸ¥ (ç”± Claude æ‰§è¡Œ)"""
        # è¿™é‡Œåªæ˜¯ç”Ÿæˆé€šçŸ¥è¯·æ±‚
        # å®é™…å‘é€ç”± Claude é€šè¿‡ Slack MCP æ‰§è¡Œ
        notification = {
            "channel": self.slack_channel,
            "message": message,
            "action": "è¯·ä½¿ç”¨ Slack MCP å‘é€æ­¤é€šçŸ¥"
        }
        # å†™å…¥é€šçŸ¥é˜Ÿåˆ—æˆ–ç›´æ¥è¾“å‡º
        print(f"[SLACK] {message}")
        return notification
```

**å®é™…å·¥ä½œæ–¹å¼** (Hooks é›†æˆ):

åœ¨ `/approve` å‘½ä»¤æ‰§è¡Œæ—¶æ·»åŠ  Slack é€šçŸ¥é€»è¾‘ï¼š

```markdown
# commands/approve.md å¢å¼º

æ‰¹æ¬¡æ‰§è¡Œæ—¶:
1. æ¯ä¸ªæ‰¹æ¬¡å¼€å§‹å‰ï¼Œä½¿ç”¨ Slack MCP å‘é€å¼€å§‹é€šçŸ¥
2. ç›‘æ§ story å®ŒæˆçŠ¶æ€
3. Story å®Œæˆ/å¤±è´¥æ—¶ï¼Œå‘é€ç›¸åº”é€šçŸ¥
4. æ‰¹æ¬¡å…¨éƒ¨å®Œæˆåï¼Œå‘é€æ±‡æ€»é€šçŸ¥

é€šçŸ¥æ ¼å¼:
- æ‰¹æ¬¡å¼€å§‹: "ğŸš€ Batch N å¼€å§‹æ‰§è¡Œ (X stories)"
- Story å®Œæˆ: "âœ… story-001: [æ ‡é¢˜] å·²å®Œæˆ"
- Story å¤±è´¥: "âŒ story-002 æ‰§è¡Œå¤±è´¥: [é”™è¯¯æ‘˜è¦]"
- æ‰¹æ¬¡å®Œæˆ: "ğŸ‰ Batch N å…¨éƒ¨å®Œæˆ (X/X stories)"
```

---

## å®Œæ•´ååŒæµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              Plan Cascade + MCP å®Œæ•´æµç¨‹                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚  ç”¨æˆ·: "/hybrid-worktree auth main 'ä½¿ç”¨ NextAuth å®ç° OAuth2 ç™»å½•'"                â”‚
â”‚                                        â”‚                                            â”‚
â”‚                                        â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ é˜¶æ®µ 1: PRD ç”Ÿæˆ                                            â”‚                   â”‚
â”‚  â”‚                                                              â”‚                   â”‚
â”‚  â”‚  1. æ£€æµ‹åº“å: "NextAuth"                                    â”‚                   â”‚
â”‚  â”‚                     â”‚                                        â”‚                   â”‚
â”‚  â”‚                     â–¼                                        â”‚                   â”‚
â”‚  â”‚  2. Context7: resolve-library-id("nextauth")                â”‚                   â”‚
â”‚  â”‚     â†’ "/nextauthjs/next-auth/v5.0.0"                        â”‚                   â”‚
â”‚  â”‚                     â”‚                                        â”‚                   â”‚
â”‚  â”‚                     â–¼                                        â”‚                   â”‚
â”‚  â”‚  3. Context7: query-docs("/nextauthjs/next-auth", "oauth")  â”‚                   â”‚
â”‚  â”‚     â†’ è¿”å› NextAuth v5 OAuth é…ç½®æ–‡æ¡£                        â”‚                   â”‚
â”‚  â”‚                     â”‚                                        â”‚                   â”‚
â”‚  â”‚                     â–¼                                        â”‚                   â”‚
â”‚  â”‚  4. ç”Ÿæˆ prd.json (åŸºäºæœ€æ–°æ–‡æ¡£)                             â”‚                   â”‚
â”‚  â”‚     stories:                                                 â”‚                   â”‚
â”‚  â”‚       - story-001: é…ç½® NextAuth providers                  â”‚                   â”‚
â”‚  â”‚       - story-002: å®ç° session ç®¡ç†                         â”‚                   â”‚
â”‚  â”‚       - story-003: æ·»åŠ ç™»å½•/ç™»å‡º UI                          â”‚                   â”‚
â”‚  â”‚                                                              â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                        â”‚                                            â”‚
â”‚                                        â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ é˜¶æ®µ 2: Story æ‰§è¡Œ (Batch 1)                                â”‚                   â”‚
â”‚  â”‚                                                              â”‚                   â”‚
â”‚  â”‚  Story-001: "é…ç½® NextAuth providers"                        â”‚                   â”‚
â”‚  â”‚                     â”‚                                        â”‚                   â”‚
â”‚  â”‚                     â–¼                                        â”‚                   â”‚
â”‚  â”‚  1. Claude Context: search_code("auth provider config")     â”‚                   â”‚
â”‚  â”‚     â†’ è¿”å›ç°æœ‰é…ç½®æ–‡ä»¶ä½ç½®                                    â”‚                   â”‚
â”‚  â”‚                     â”‚                                        â”‚                   â”‚
â”‚  â”‚                     â–¼                                        â”‚                   â”‚
â”‚  â”‚  2. Context7: query-docs("nextauth providers github oauth") â”‚                   â”‚
â”‚  â”‚     â†’ è¿”å› GitHub OAuth provider é…ç½®ç¤ºä¾‹                     â”‚                   â”‚
â”‚  â”‚                     â”‚                                        â”‚                   â”‚
â”‚  â”‚                     â–¼                                        â”‚                   â”‚
â”‚  â”‚  3. å®ç°ä»£ç  (åŸºäºæœç´¢ç»“æœå’Œæ–‡æ¡£)                             â”‚                   â”‚
â”‚  â”‚                     â”‚                                        â”‚                   â”‚
â”‚  â”‚                     â–¼                                        â”‚                   â”‚
â”‚  â”‚  4. æ›´æ–° findings.md, progress.txt                          â”‚                   â”‚
â”‚  â”‚                     â”‚                                        â”‚                   â”‚
â”‚  â”‚                     â–¼                                        â”‚                   â”‚
â”‚  â”‚  5. Slack: "âœ… story-001 å®Œæˆ: é…ç½® NextAuth providers"     â”‚                   â”‚
â”‚  â”‚                                                              â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                        â”‚                                            â”‚
â”‚                                        â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ é˜¶æ®µ 3: æ‰¹æ¬¡å®Œæˆé€šçŸ¥                                         â”‚                   â”‚
â”‚  â”‚                                                              â”‚                   â”‚
â”‚  â”‚  æ£€æµ‹åˆ° Batch 1 å…¨éƒ¨å®Œæˆ                                     â”‚                   â”‚
â”‚  â”‚                     â”‚                                        â”‚                   â”‚
â”‚  â”‚                     â–¼                                        â”‚                   â”‚
â”‚  â”‚  Slack: "ğŸ‰ Batch 1 å®Œæˆ (1/1 stories)"                     â”‚                   â”‚
â”‚  â”‚                     â”‚                                        â”‚                   â”‚
â”‚  â”‚                     â–¼                                        â”‚                   â”‚
â”‚  â”‚  è‡ªåŠ¨å¼€å§‹ Batch 2...                                         â”‚                   â”‚
â”‚  â”‚                                                              â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## MCP æœåŠ¡ä»·å€¼æ€»ç»“

| é˜¶æ®µ | MCP æœåŠ¡ | ä»·å€¼ | é™ä½å¹»è§‰æ–¹å¼ |
|------|----------|------|-------------|
| PRD ç”Ÿæˆ | **Context7** | ä½¿ç”¨æœ€æ–° API ç”Ÿæˆå‡†ç¡®çš„ acceptance criteria | åŸºäºæœ€æ–°æ–‡æ¡£ï¼Œè€Œéè¿‡æ—¶è®­ç»ƒæ•°æ® |
| Story æ‰§è¡Œ | **Claude Context** | äº†è§£ç°æœ‰ä»£ç ï¼Œé¿å…é‡å¤/å†²çª | åŸºäºå®é™…ä»£ç ï¼Œè€ŒéçŒœæµ‹ |
| Story æ‰§è¡Œ | **Context7** | å®ç°æ—¶ä½¿ç”¨æ­£ç¡®çš„ API è°ƒç”¨ | ç‰ˆæœ¬ç‰¹å®šçš„æ­£ç¡®ç”¨æ³• |
| å®Œæˆé€šçŸ¥ | **Slack** | å®æ—¶å›¢é˜ŸåŒæ­¥ | N/A |

---

## å®ç°ä¼˜å…ˆçº§

### P0: æ— éœ€ä»£ç ä¿®æ”¹ (ç«‹å³å¯ç”¨)

Context7 å’Œ Slack å·²ä½œä¸º Claude Code å®˜æ–¹æ’ä»¶å®‰è£…ï¼Œå¯ä»¥é€šè¿‡ **Prompt å¢å¼º** ç›´æ¥ä½¿ç”¨ï¼š

1. åœ¨ `/hybrid-worktree` å‘½ä»¤ä¸­æ·»åŠ æŒ‡ä»¤ï¼šä½¿ç”¨ context7 è·å–åº“æ–‡æ¡£
2. åœ¨ `/approve` å‘½ä»¤ä¸­æ·»åŠ æŒ‡ä»¤ï¼šä½¿ç”¨ Slack å‘é€é€šçŸ¥
3. åœ¨ Agent Prompt ä¸­æ·»åŠ æŒ‡ä»¤ï¼šä½¿ç”¨ context7 æŸ¥è¯¢ API

### P1: éœ€è¦é…ç½® Claude Context

1. æ³¨å†Œ Zilliz Cloud (å…è´¹)
2. é…ç½® Claude Context MCP
3. åœ¨ Agent Prompt ä¸­æ·»åŠ ä»£ç æœç´¢æŒ‡ä»¤

### P2: ä»£ç é›†æˆ (å¯é€‰å¢å¼º)

1. ä¿®æ”¹ `context_filter.py` ç”Ÿæˆæœç´¢æŸ¥è¯¢
2. ä¿®æ”¹ `orchestrator.py` æ·»åŠ é€šçŸ¥å›è°ƒ
3. ä¿®æ”¹ `prd_generator.py` æ·»åŠ åº“æ£€æµ‹

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **æµ‹è¯• Context7 é›†æˆ**: è¿è¡Œ `/hybrid-worktree` å¹¶è§‚å¯Ÿæ˜¯å¦è‡ªåŠ¨ä½¿ç”¨ context7
2. **å®Œæˆ Slack OAuth**: æˆæƒ Slack æ’ä»¶è®¿é—®å·¥ä½œåŒº
3. **é…ç½® Claude Context**: æ³¨å†Œ Zilliz å¹¶æ·»åŠ  MCP
4. **å¢å¼ºå‘½ä»¤æ–‡ä»¶**: åœ¨å‘½ä»¤ä¸­æ·»åŠ  MCP ä½¿ç”¨æŒ‡ä»¤
