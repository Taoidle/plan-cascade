# Plan Cascade Standalone - 产品需求文档 (PRD)

**版本**: 2.0.0
**日期**: 2026-01-28
**作者**: Plan Cascade Team
**状态**: Draft

---

## 1. 概述

### 1.1 产品愿景

将 Plan Cascade 从 Claude Code Plugin 发展为一个**开箱即用的独立客户端**，让 AI 编程变得简单。

**核心定位**：
- 作为 **Claude Code 的图形化界面**（默认模式）
- 作为 **独立的多 Agent 编排工具**（支持其他 LLM）

### 1.2 核心价值主张

| 价值点 | 描述 |
|--------|------|
| **易用性优先** | 描述需求即可，AI 自动处理一切 |
| **开箱即用** | 下载安装即可使用，无需复杂配置 |
| **双模式切换** | 简单模式快速上手，专家模式精细控制 |
| **模型自由** | 支持 Claude Code、OpenAI、DeepSeek 等多种后端 |
| **理念延续** | 完整保留 Plan Cascade 的核心设计理念 |

### 1.3 产品定位

```
┌─────────────────────────────────────────────────────────────┐
│                 Plan Cascade Desktop                         │
│            让 AI 编程变得简单的客户端                         │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│                    ┌─────────────────┐                       │
│                    │   选择后端       │                       │
│                    └────────┬────────┘                       │
│                             │                                │
│          ┌──────────────────┼──────────────────┐             │
│          ▼                  ▼                  ▼             │
│   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│   │ Claude Code │    │   OpenAI    │    │  DeepSeek   │     │
│   │  (默认)     │    │ BuiltinAgent│    │ BuiltinAgent│     │
│   │ 作为其 GUI  │    │             │    │             │     │
│   └─────────────┘    └─────────────┘    └─────────────┘     │
│                                                              │
└─────────────────────────────────────────────────────────────┘

使用 Claude Code 时：Plan Cascade = Claude Code 的 GUI
使用其他 LLM 时：Plan Cascade = 独立的编排工具
```

### 1.4 目标用户

| 用户群体 | 场景 | 痛点 | 解决方案 |
|----------|------|------|----------|
| **新手开发者** | 想用 AI 辅助开发 | Claude Code CLI 学习成本高 | 简单模式一键完成 |
| **资深开发者** | 需要精细控制 | 现有工具控制力不足 | 专家模式自定义 |
| **小型团队** | 统一工具链 | 不同成员用不同 LLM | 多后端支持 |
| **企业用户** | 数据安全要求 | 需要私有部署 | 支持本地模型 |

---

## 2. 核心设计理念

### 2.1 易用性优先

**设计原则**：用户只需描述想做什么，系统自动处理一切。

```
用户输入
   │
   ▼
"帮我做一个用户登录功能，要支持 OAuth 和手机验证码"
   │
   ▼
┌─────────────────────────────────────────────────────────────┐
│                    Plan Cascade 自动处理                     │
│                                                              │
│   ✓ 判断任务规模 → 自动选择执行策略                         │
│   ✓ 生成 PRD 和 Stories                                     │
│   ✓ 分析依赖关系 → 安排执行批次                             │
│   ✓ 选择合适的 Agent                                        │
│   ✓ 并行执行任务                                            │
│   ✓ 自动质量检查和重试                                      │
│                                                              │
└─────────────────────────────────────────────────────────────┘
   │
   ▼
完成
```

**用户不需要理解**：Mega Plan、Hybrid Ralph、Worktree、批次依赖等内部概念。

### 2.2 双模式设计

#### 简单模式（默认）

面向：新手用户、快速任务

```
┌─ 简单模式 ──────────────────────────────────────────────────┐
│                                                              │
│   描述你想要实现的功能：                                     │
│   ┌────────────────────────────────────────────────────────┐│
│   │ 实现用户登录功能，支持 OAuth 和手机验证码               ││
│   └────────────────────────────────────────────────────────┘│
│                                                              │
│                              [开始] ← 一键启动，自动完成全部 │
│                                                              │
│  ────────────────────────────────────────────────────────── │
│                                                              │
│   执行中...                                                  │
│   ┌────────────────────────────────────────────────────────┐│
│   │ ✓ 生成计划 (5 个任务)                                  ││
│   │ ✓ Batch 1: 数据库 Schema, API 路由 (2/2)               ││
│   │ ⟳ Batch 2: OAuth 登录, 手机验证码 (1/2)                ││
│   │ ○ Batch 3: 集成测试                                    ││
│   └────────────────────────────────────────────────────────┘│
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

#### 专家模式

面向：资深用户、需要精细控制

```
┌─ 专家模式 ──────────────────────────────────────────────────┐
│                                                              │
│  ┌─ Step 1: 需求输入 ──────────────────────────────────────┐│
│  │ 实现用户登录功能，支持 OAuth 和手机验证码               ││
│  └────────────────────────────────────────────────────────┘│
│                                            [生成 PRD]       │
│                                                              │
│  ┌─ Step 2: Review PRD ────────────────────────────────────┐│
│  │                                                          ││
│  │  执行策略:                        AI 建议: Hybrid Auto  ││
│  │  ○ 直接执行   ● Hybrid Auto   ○ Mega Plan              ││
│  │                                                          ││
│  │  □ 使用 Git Worktree 隔离开发                           ││
│  │                                                          ││
│  │  Stories:                                    [+ 添加]   ││
│  │  ┌────────────────────────────────────────────────────┐ ││
│  │  │ □ 设计数据库 Schema                                │ ││
│  │  │   Priority: high  │  Agent: [claude-code ▼]        │ ││
│  │  │   Dependencies: none                    [编辑][删除]│ ││
│  │  ├────────────────────────────────────────────────────┤ ││
│  │  │ □ 实现 OAuth 登录                                  │ ││
│  │  │   Priority: medium │  Agent: [aider ▼]             │ ││
│  │  │   Dependencies: [Schema ▼]              [编辑][删除]│ ││
│  │  └────────────────────────────────────────────────────┘ ││
│  │                                                          ││
│  │  质量门控: [✓] TypeCheck  [✓] Test  [✓] Lint  [ ] Custom ││
│  │                                                          ││
│  └──────────────────────────────────────────────────────────┘│
│                                                              │
│                              [保存草稿]  [开始执行]          │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

#### 模式对比

| 功能 | 简单模式 | 专家模式 |
|------|----------|----------|
| 需求输入 | ✓ | ✓ |
| 自动生成 PRD | ✓ (直接执行) | ✓ (可编辑) |
| Review/编辑 PRD | ✗ | ✓ |
| 选择执行策略 | ✗ (AI 自动) | ✓ |
| 指定 Agent | ✗ (自动) | ✓ |
| 调整依赖关系 | ✗ | ✓ |
| 自定义质量门控 | ✗ (使用默认) | ✓ |
| 执行监控 | 简化视图 | 详细视图 |
| 日志查看 | 仅错误 | 完整日志 |

### 2.3 AI 自动判断执行策略

简单模式下，AI 根据用户需求自动选择最佳执行策略：

```
用户输入                              AI 判断                    内部执行
───────────────────────────────────────────────────────────────────────────
"添加一个退出按钮"            →   小任务              →   直接执行（无 PRD）

"实现用户登录功能"            →   中等功能            →   Hybrid Auto
                                                          (自动生成 PRD)

"开发一个博客系统，           →   大型项目            →   Mega Plan
 包含用户、文章、评论"                                    (多 PRD 级联)

"重构支付模块，               →   需要隔离            →   Hybrid Worktree
 不要影响现有功能"                                        (Git 隔离开发)
```

**判断维度**：
1. **任务规模**：单一任务 / 多功能 / 完整项目
2. **复杂度**：是否需要分解为多个 Stories
3. **风险程度**：是否需要隔离开发
4. **依赖关系**：是否有跨模块依赖

### 2.4 核心架构理念（必须保留）

#### 层层分解

```
项目 (Mega Plan)
   │
   ├── 功能1 (Hybrid Ralph / PRD)
   │      ├── Story 1.1
   │      ├── Story 1.2
   │      └── Story 1.3
   │
   └── 功能2 (Hybrid Ralph / PRD)
          ├── Story 2.1
          └── Story 2.2
```

#### 并行执行

```
批次1: [Story A, Story B, Story C]  ← 无依赖，并行执行
           ↓ 全部完成
批次2: [Story D, Story E]           ← 依赖批次1，并行执行
           ↓ 全部完成
批次3: [Story F]                    ← 依赖批次2
```

#### 多 Agent 协作

- 根据任务类型自动选择最优 Agent
- 支持 Agent 降级链（主 Agent 不可用时自动切换）
- 支持阶段化 Agent 配置

#### 质量保障

- **质量门控**: typecheck、test、lint、custom
- **智能重试**: 失败后自动重试，注入失败上下文
- **可配置**: 门控类型、重试次数均可配置

#### 状态追踪

- **基于文件的状态共享**: prd.json、.agent-status.json
- **发现共享**: findings.md 记录开发过程中的发现
- **断点恢复**: 中断后可从上次状态继续

---

## 3. 产品形态

### 3.1 三形态统一架构

```
┌─────────────────────────────────────────────────────────────┐
│                   Plan Cascade                               │
├───────────────────┬───────────────────┬─────────────────────┤
│   桌面应用 (GUI)   │    CLI 工具       │  Claude Code Plugin │
├───────────────────┼───────────────────┼─────────────────────┤
│ • 图形化界面      │ • 命令行操作      │ • 依赖 Claude Code   │
│ • 简单/专家模式   │ • 简单/专家模式   │ • 作为插件运行       │
│ • 可作为 Claude   │ • pip install     │ • Slash 命令调用     │
│   Code 的 GUI     │   plan-cascade    │                     │
└───────────────────┴───────────────────┴─────────────────────┘
                           │
                           ▼
                ┌─────────────────┐
                │ Plan Cascade    │
                │ Core (共享)     │
                └─────────────────┘
```

### 3.2 发布产物

| 产物 | 说明 | 目标用户 |
|------|------|----------|
| **桌面应用** | Windows/macOS/Linux 安装包 | 希望开箱即用的用户 |
| **CLI 工具** | `pip install plan-cascade` | 喜欢命令行的开发者 |
| **Claude Code Plugin** | 现有 Plugin (保持兼容) | Claude Code 用户 |
| **Python 包** | `plan-cascade-core` | 集成到其他工具的开发者 |

---

## 4. 功能需求

### 4.1 后端选择 (P0)

#### Claude Code 模式（默认）

Plan Cascade 作为 Claude Code 的图形化界面：

```
┌─ 设置 ──────────────────────────────────────────────────────┐
│                                                              │
│  后端选择：                                                  │
│                                                              │
│  ● Claude Code（推荐）                                       │
│    └─ Plan Cascade 作为 Claude Code 的图形界面              │
│    └─ 完整复用 Claude Code 的所有能力                        │
│    └─ 无需额外配置 API Key                                   │
│                                                              │
│  ○ Claude API                                                │
│    └─ 直接调用 Anthropic API                                 │
│    └─ 需要配置 API Key                                       │
│                                                              │
│  ○ OpenAI                                                    │
│    └─ 使用 GPT-4o 等模型                                     │
│    └─ 需要配置 API Key                                       │
│                                                              │
│  ○ 其他...                                                   │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

**两种模式的本质区别**：

| | Claude Code 模式 | 其他 LLM 模式 |
|---|---|---|
| **主 Agent** | Claude Code 进程 | BuiltinAgent (自实现) |
| **工具调用** | Claude Code 内置 | Plan Cascade 实现 |
| **Plan Cascade 角色** | GUI 外壳 | 完整运行时 |
| **配置** | 无需 API Key | 需要 API Key |

#### 支持的后端

| 后端 | 优先级 | 说明 |
|------|--------|------|
| Claude Code | P0 | 默认选项，作为其 GUI |
| Claude API | P0 | 直接调用 Anthropic API |
| OpenAI | P0 | GPT-4o 等模型 |
| DeepSeek | P1 | 国内用户 |
| Ollama | P2 | 本地模型 |

### 4.2 简单模式功能 (P0)

#### 一键式工作流

```bash
# CLI
plan-cascade "实现用户登录功能，支持 OAuth"
# 自动完成：分析 → 生成计划 → 执行 → 质量检查

# GUI
# 输入描述 → 点击"开始" → 等待完成
```

#### 简化状态展示

```
执行中...

[████████████░░░░░░░░] 60%

✓ 生成计划 (5 个任务)
✓ 数据库 Schema
✓ API 路由结构
⟳ OAuth 登录 (执行中...)
○ 手机验证码登录
○ 集成测试
```

### 4.3 专家模式功能 (P0)

#### PRD 编辑器

- 可视化编辑 Stories
- 拖拽调整顺序
- 设置依赖关系
- 指定执行 Agent

#### 执行策略选择

```
执行策略:                           AI 建议: Hybrid Auto
○ 直接执行（简单任务，无需 PRD）
● Hybrid Auto（自动生成 PRD 并执行）
○ Mega Plan（大型项目，多个 PRD）

隔离选项:
□ 使用 Git Worktree 隔离开发
```

#### Agent 指定

每个 Story 可以指定不同的 Agent：

```
┌─ Story: 实现 OAuth 登录 ─────────────────────────────────────┐
│                                                              │
│  Agent: [claude-code ▼]                                      │
│         ├─ claude-code (推荐)                                │
│         ├─ aider                                             │
│         ├─ codex                                             │
│         └─ builtin                                           │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

### 4.4 设置页面 (P0)

#### Agent 配置

```
┌─ 设置 > Agent 配置 ─────────────────────────────────────────┐
│                                                              │
│  主后端（编排用）                                            │
│  ┌────────────────────────────────────────────────────────┐ │
│  │ ● Claude Code（推荐，无需配置）                        │ │
│  │ ○ Claude API    [API Key: ••••••••••]                  │ │
│  │ ○ OpenAI        [API Key: ••••••••••] [Model: gpt-4o ▼]│ │
│  │ ○ DeepSeek      [API Key: ••••••••••]                  │ │
│  │ ○ Ollama        [URL: http://localhost:11434]          │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                              │
│  ───────────────────────────────────────────────────────────│
│                                                              │
│  执行 Agent（Story 执行用）                      [+ 添加]   │
│  ┌────────────────────────────────────────────────────────┐ │
│  │ ✓ claude-code                              [默认]      │ │
│  │   └─ 路径: claude                                      │ │
│  ├────────────────────────────────────────────────────────┤ │
│  │ ✓ aider                                    [配置]      │ │
│  │   └─ 命令: aider --model gpt-4o                        │ │
│  ├────────────────────────────────────────────────────────┤ │
│  │ □ codex (未配置)                           [配置]      │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                              │
│  Agent 自动选择策略:                                         │
│  ○ 智能匹配（根据任务类型自动选择）                          │
│  ● 优先使用: [claude-code ▼]                                │
│  ○ 手动指定（每个 Story 单独选择）                          │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

#### 质量门控配置

```
┌─ 设置 > 质量门控 ───────────────────────────────────────────┐
│                                                              │
│  默认启用的检查:                                             │
│  [✓] TypeCheck (tsc / mypy / pyright)                       │
│  [✓] Test (pytest / jest / npm test)                        │
│  [✓] Lint (eslint / ruff)                                   │
│  [ ] Custom                                                  │
│                                                              │
│  自定义脚本:                                                 │
│  ┌────────────────────────────────────────────────────────┐ │
│  │ npm run validate                                        │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                              │
│  重试设置:                                                   │
│  最大重试次数: [3]                                           │
│  重试间隔: [指数退避 ▼]                                     │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

### 4.5 CLI 功能 (P1)

```bash
# 简单模式（默认）
plan-cascade "实现用户登录功能"
# 自动完成全部流程

# 专家模式
plan-cascade --expert "实现用户登录功能"

# 专家模式交互
$ plan-cascade --expert "实现用户登录"
✓ 已生成 PRD (5 个 Stories)

? 请选择操作:
  > 查看/编辑 PRD
    修改 Agent 分配
    调整依赖关系
    开始执行
    保存草稿并退出

# 分步命令
plan-cascade generate "实现用户登录"  # 只生成 PRD
plan-cascade review                    # 交互式编辑
plan-cascade run                       # 执行
plan-cascade status                    # 查看状态
```

### 4.6 作为 Claude Code GUI (P0)

当选择 Claude Code 作为后端时，Plan Cascade 提供：

```
┌─ Plan Cascade (Claude Code Mode) ───────────────────────────┐
│                                                              │
│  ┌─ 对话 ───────────────────────────────────────────────┐   │
│  │                                                      │   │
│  │  You: 帮我重构 auth 模块                             │   │
│  │                                                      │   │
│  │  Claude: 正在分析...                                 │   │
│  │                                                      │   │
│  └──────────────────────────────────────────────────────┘   │
│                                                              │
│  ┌─ 工具调用 (可视化) ─────────────────────────────────┐    │
│  │ ✓ Read src/auth/login.py                            │    │
│  │ ✓ Read src/auth/oauth.py                            │    │
│  │ ⟳ Edit src/auth/base.py                             │    │
│  └─────────────────────────────────────────────────────┘    │
│                                                              │
│  ┌─ 文件变更预览 ──────────────────────────────────────┐    │
│  │ - old code                                          │    │
│  │ + new code                                          │    │
│  └─────────────────────────────────────────────────────┘    │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

**比 CLI 更直观**：
- 工具调用可视化
- 文件变更实时预览
- 执行历史可回溯
- 错误信息清晰展示

---

## 5. 非功能需求

### 5.1 性能要求

| 指标 | 要求 |
|------|------|
| 启动时间 | < 3 秒 |
| 内存占用 | < 500MB (空闲状态) |
| 并行 Story 数 | 支持至少 5 个并行 |
| API 超时 | 可配置，默认 5 分钟 |

### 5.2 兼容性要求

| 平台 | 最低版本 |
|------|----------|
| Windows | Windows 10 |
| macOS | macOS 11 (Big Sur) |
| Linux | Ubuntu 20.04 / 同等 |
| Python | 3.10+ (CLI/Core) |

### 5.3 安全要求

- API Key 本地加密存储
- 不上传用户代码到第三方服务（除 LLM API）
- Shell 命令执行安全检查
- 敏感文件保护（.env, credentials 等）

---

## 6. 与竞品对比

| 特性 | Plan Cascade | Claude Code CLI | Cursor | Aider |
|------|--------------|-----------------|--------|-------|
| **图形界面** | ✅ | ❌ | ✅ | ❌ |
| **CLI 支持** | ✅ | ✅ | ❌ | ✅ |
| **多 LLM 支持** | ✅ | ❌ | ❌ | ✅ |
| **任务分解** | ✅ 自动 | ❌ 手动 | ❌ | ❌ |
| **并行执行** | ✅ | ❌ | ❌ | ❌ |
| **质量门控** | ✅ | ❌ | ❌ | ⚠️ |
| **简单模式** | ✅ | ❌ | ✅ | ❌ |
| **专家模式** | ✅ | ✅ | ❌ | ✅ |
| **开箱即用** | ✅ | ⚠️ | ✅ | ⚠️ |

---

## 7. 里程碑计划

### Phase 1: CLI + 双模式

**目标**: 可独立运行的 CLI，支持简单/专家模式

**功能范围**:
- [ ] 核心包重构
- [ ] LLM Provider 抽象层
- [ ] 简单模式实现
- [ ] 专家模式实现
- [ ] AI 自动策略判断
- [ ] 基础 CLI 命令

### Phase 2: 桌面应用 Alpha

**目标**: 图形化界面

**功能范围**:
- [ ] Tauri 桌面框架
- [ ] 简单模式 UI
- [ ] 专家模式 UI
- [ ] 设置页面
- [ ] Claude Code GUI 模式

### Phase 3: 功能完善

**目标**: 生产可用

**功能范围**:
- [ ] 完整 PRD 编辑器
- [ ] 依赖关系可视化
- [ ] 更多 LLM 后端
- [ ] 自动更新

### Phase 4: 高级功能

**目标**: 差异化优势

**功能范围**:
- [ ] 多 Agent 协作
- [ ] Git Worktree 集成
- [ ] 团队协作
- [ ] 插件系统

---

## 8. 成功指标

| 指标 | 目标 |
|------|------|
| 用户上手时间 | < 5 分钟（简单模式） |
| 任务完成率 | > 80%（简单任务） |
| 用户留存 | 30% (月活跃) |
| GitHub Stars | 1000+ (6个月内) |

---

## 9. 附录

### 9.1 术语表（用户手册中可隐藏）

| 术语 | 定义 | 用户是否需要理解 |
|------|------|-----------------|
| Mega Plan | 项目级别的规划 | 专家模式可选 |
| Hybrid Ralph | PRD 驱动的开发模式 | 专家模式可选 |
| Story | 最小可执行任务 | 专家模式需要 |
| Batch | 可并行执行的任务集合 | 不需要 |
| Quality Gate | 质量检查 | 设置中可配置 |
| BuiltinAgent | 内置 Agent | 不需要 |

### 9.2 简单模式 vs 专家模式 快速参考

```
简单模式适合：
✓ 新手用户
✓ 快速原型
✓ 单一功能开发
✓ 不想配置的场景

专家模式适合：
✓ 资深开发者
✓ 复杂项目
✓ 需要精细控制
✓ 多人协作
```
