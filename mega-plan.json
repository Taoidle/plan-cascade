{
  "metadata": {
    "created_at": "2026-01-28T10:30:00Z",
    "version": "1.0.0"
  },
  "goal": "将 Plan Cascade 从 Claude Code Plugin 重构为独立的多形态客户端",
  "description": "基于 docs/PRD-Plan-Cascade-Standalone.md 和 docs/Design-Plan-Cascade-Standalone.md 的设计，将 Plan Cascade 独立化，包含：1) 核心包重构为 src/plan_cascade/，2) Backend 抽象层（ClaudeCodeBackend + BuiltinBackend），3) CLI 双模式（简单/专家），4) 设置管理系统，5) 桌面应用基础框架",
  "execution_mode": "auto",
  "target_branch": "develop",
  "features": [
    {
      "id": "feature-001",
      "name": "feature-core-package",
      "title": "核心包重构 (src/plan_cascade/)",
      "description": "将现有 skills/hybrid-ralph/core/ 和 skills/mega-plan/core/ 的代码重构为独立的 Python 包 src/plan_cascade/。包含：\n\n1. **核心模块迁移**: 将 orchestrator.py, prd_generator.py, state_manager.py, context_filter.py, iteration_loop.py, quality_gate.py, retry_manager.py 等迁移到 src/plan_cascade/core/\n\n2. **模块结构**: 按设计文档组织为 core/, backends/, llm/, tools/, settings/, state/, cli/ 子目录\n\n3. **导入路径更新**: 更新所有内部导入路径为新包结构\n\n4. **pyproject.toml 更新**: 配置 plan-cascade 包元数据、入口点、依赖项\n\n5. **保持兼容**: 确保现有 Plugin 功能不受影响，通过符号链接或重新导出保持向后兼容",
      "priority": "high",
      "dependencies": [],
      "status": "pending"
    },
    {
      "id": "feature-002",
      "name": "feature-backend-abstraction",
      "title": "Backend 抽象层实现",
      "description": "实现后端抽象层，支持 Claude Code 作为 GUI 和独立 LLM 两种模式。包含：\n\n1. **AgentBackend 基类** (src/plan_cascade/backends/base.py): 定义 execute(), get_llm(), get_name() 等抽象方法，ExecutionResult 数据类\n\n2. **ClaudeCodeBackend** (src/plan_cascade/backends/claude_code.py): 通过子进程与 Claude Code 通信，解析 JSON 流输出，提供工具调用可视化回调\n\n3. **BuiltinBackend** (src/plan_cascade/backends/builtin.py): 使用 LLM API 独立运行，实现 ReAct 循环，集成工具注册表\n\n4. **BackendFactory** (src/plan_cascade/backends/factory.py): 根据配置创建合适的后端实例\n\n5. **LLM Provider 抽象**: 实现 LLMProvider 基类和 Claude/OpenAI/Ollama providers (src/plan_cascade/llm/)\n\n6. **工具注册表**: 实现 ToolRegistry 和基础工具 (read_file, write_file, edit_file, run_command, search_files)",
      "priority": "high",
      "dependencies": ["feature-001"],
      "status": "pending"
    },
    {
      "id": "feature-003",
      "name": "feature-cli-dual-mode",
      "title": "CLI 双模式实现 (简单/专家)",
      "description": "实现 CLI 工具，支持简单模式和专家模式。包含：\n\n1. **模式定义** (src/plan_cascade/core/mode.py): UserMode 枚举，ModeConfig 数据类，简单/专家模式工厂方法\n\n2. **策略分析器** (src/plan_cascade/core/strategy_analyzer.py): AI 驱动的策略判断，自动选择 Direct/HybridAuto/MegaPlan\n\n3. **简单模式工作流** (src/plan_cascade/core/simple_workflow.py): 一键执行流程，自动策略选择，进度回调\n\n4. **专家模式工作流** (src/plan_cascade/core/expert_workflow.py): 交互式 PRD 编辑，策略选择，Agent 指定\n\n5. **CLI 入口** (src/plan_cascade/cli/main.py): 使用 Typer 实现命令\n   - `plan-cascade run <description>` 简单模式\n   - `plan-cascade run --expert <description>` 专家模式\n   - `plan-cascade config --show/--setup` 配置管理\n   - `plan-cascade status` 状态查看\n\n6. **Rich 输出**: 使用 rich 库实现美观的终端输出，进度条，表格",
      "priority": "high",
      "dependencies": ["feature-001", "feature-002"],
      "status": "pending"
    },
    {
      "id": "feature-004",
      "name": "feature-settings-system",
      "title": "设置管理系统",
      "description": "实现完整的设置管理系统。包含：\n\n1. **设置模型** (src/plan_cascade/settings/models.py):\n   - BackendType 枚举 (CLAUDE_CODE, CLAUDE_API, OPENAI, DEEPSEEK, OLLAMA)\n   - AgentConfig 数据类（执行 Agent 配置）\n   - QualityGateConfig 数据类（质量门控配置）\n   - Settings 主类（所有配置项）\n\n2. **设置存储** (src/plan_cascade/settings/storage.py):\n   - YAML 配置文件读写 (~/.plan-cascade/config.yaml)\n   - keyring 集成安全存储 API Key\n   - 配置迁移和版本管理\n\n3. **配置向导**: CLI 交互式配置向导，引导用户选择后端和配置 API Key\n\n4. **配置验证**: 验证配置完整性，检测必要的凭证是否存在\n\n5. **默认配置**: 合理的默认值，Claude Code 模式零配置可用",
      "priority": "medium",
      "dependencies": ["feature-001"],
      "status": "pending"
    },
    {
      "id": "feature-005",
      "name": "feature-desktop-foundation",
      "title": "桌面应用基础框架",
      "description": "搭建桌面应用基础框架，为后续 UI 开发打基础。包含：\n\n1. **Tauri 项目初始化** (desktop/):\n   - 创建 Tauri + React + TypeScript 项目结构\n   - 配置跨平台构建 (Windows/macOS/Linux)\n\n2. **FastAPI Sidecar** (server/plan_cascade_server/):\n   - 实现 HTTP API 和 WebSocket 接口\n   - 桥接前端和 Python 核心包\n   - 实时执行状态推送\n\n3. **基础 UI 组件** (desktop/src/components/):\n   - ModeSwitch 组件（简单/专家模式切换）\n   - SettingsButton 组件\n   - 基础布局 (App.tsx)\n\n4. **状态管理** (desktop/src/store/):\n   - Zustand store 设置\n   - mode.ts, execution.ts, settings.ts\n\n5. **Tauri 命令**: 实现基本的 Tauri 命令与 Python sidecar 通信\n\n注: 此 Feature 为 MVP 框架，完整 UI 将在后续 Phase 实现",
      "priority": "low",
      "dependencies": ["feature-001", "feature-002", "feature-003", "feature-004"],
      "status": "pending"
    }
  ]
}
